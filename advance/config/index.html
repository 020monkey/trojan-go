<!DOCTYPE html>
<html lang="en-us">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>完整的配置文件 - Trojan-Go</title>
<meta name="description" content="An unidentifiable mechanism that helps you bypass GFW. ">
<meta name="generator" content="Hugo 0.69.0" />
<link href="https://p4gefau1t.github.io/trojan-goindex.xml" rel="alternate" type="application/rss+xml">
<link rel="canonical" href="https://p4gefau1t.github.io/trojan-go/advance/config/">
<link rel="stylesheet" href="https://p4gefau1t.github.io/trojan-go/css/theme.min.css">
<script src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
<link rel="stylesheet" href="https://p4gefau1t.github.io/trojan-go/css/chroma.min.css">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js"></script>
<script src="https://p4gefau1t.github.io/trojan-go/js/bundle.js"></script><style>
:root {}
</style>
<meta property="og:title" content="完整的配置文件" />
<meta property="og:description" content="下面是一个完整的配置文件，其中的必填选项有 run_type local_addr local_port remote_addr remote_port 对于一个服务器server，key和cert为必填。 其余未填的选项，用下面给出的值进行填" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://p4gefau1t.github.io/trojan-go/advance/config/" />
<meta property="og:image" content="https://p4gefau1t.github.io/trojan-go/images/og-image.png"/>
<meta property="og:site_name" content="Hugo Techdoc Theme" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://p4gefau1t.github.io/trojan-go/images/og-image.png"/>

<meta name="twitter:title" content="完整的配置文件"/>
<meta name="twitter:description" content="下面是一个完整的配置文件，其中的必填选项有 run_type local_addr local_port remote_addr remote_port 对于一个服务器server，key和cert为必填。 其余未填的选项，用下面给出的值进行填"/>
<meta itemprop="name" content="完整的配置文件">
<meta itemprop="description" content="下面是一个完整的配置文件，其中的必填选项有 run_type local_addr local_port remote_addr remote_port 对于一个服务器server，key和cert为必填。 其余未填的选项，用下面给出的值进行填">

<meta itemprop="wordCount" content="3094">
<meta itemprop="image" content="https://p4gefau1t.github.io/trojan-go/images/og-image.png"/>



<meta itemprop="keywords" content="" /></head>
<body><div class="container"><header>
<h1>Trojan-Go</h1>

 <span class="version">Version 0.1.3</span>
<a href="https://github.com/p4gefau1t/trojan-go" class="github"><i class="fab fa-github"></i></a>
<p class="description">An unidentifiable mechanism that helps you bypass GFW. </p>

</header>
<div class="global-menu">
<nav>
<ul>
<li><a href="/trojan-go/">Home</a></li>
<li><a href="https://github.com/p4gefau1t">GitHub</a></li>
<li><a href="https://twitter.com/p4gefau1t">Twitter</a></li></ul>
</nav>
</div>
<div class="content-container">
<main><h1>完整的配置文件</h1>
<p>下面是一个完整的配置文件，其中的必填选项有</p>
<ul>
<li>
<p><code>run_type</code></p>
</li>
<li>
<p><code>local_addr</code></p>
</li>
<li>
<p><code>local_port</code></p>
</li>
<li>
<p><code>remote_addr</code></p>
</li>
<li>
<p><code>remote_port</code></p>
</li>
</ul>
<p>对于一个服务器server，<code>key</code>和<code>cert</code>为必填。</p>
<p>其余未填的选项，用下面给出的值进行填充。</p>
<pre><code>{
    &quot;run_type&quot;: &quot;client/server/nat&quot;,
    &quot;local_addr&quot;: &quot;127.0.0.1&quot;,
    &quot;local_port&quot;:  your_port1,
    &quot;remote_addr&quot;: &quot;example.com&quot;,
    &quot;remote_port&quot;: your_port2,
    &quot;log_level&quot;: 0,
    &quot;password&quot;: [
        &quot;password1&quot;,
        &quot;password2&quot;
    ],
    &quot;ssl&quot;: {
        &quot;verify&quot;: true,
        &quot;cert&quot;: &quot;your_crt_file(optional for a client/nat)&quot;,
        &quot;key&quot;: &quot;your_key_file&quot;,
        &quot;key_password&quot;: &quot;&quot;,
        &quot;cipher&quot;: &quot;&quot;,
        &quot;cipher_tls13&quot;: &quot;&quot;,
        &quot;prefer_server_cipher&quot;: false,
        &quot;sni&quot;: &quot;your_domain_name&quot;,
        &quot;session_ticket&quot;: true,
        &quot;plain_http_response&quot;: &quot;&quot;,
        &quot;fallback_port&quot;:0
    },
    &quot;tcp&quot;: {
        &quot;no_delay&quot;: false,
        &quot;reuse_port&quot;: false,
        &quot;prefer_ipv4&quot;: false,
        &quot;fast_open&quot;: false,
    },
    &quot;mux&quot;: {
        &quot;enabled&quot;: false,
        &quot;concurrency&quot;: 8,
        &quot;idle_timeout&quot;: 60
    },
    &quot;router&quot;: {
        &quot;enabled&quot;: false,
        &quot;bypass&quot;: [],
        &quot;proxy&quot;: [],
        &quot;block&quot;: [],
        &quot;route_by_ip&quot;: false,
        &quot;route_by_ip_on_nonmatch&quot;: false，
        &quot;default_policy&quot;: &quot;proxy&quot;
    },
    &quot;websocket&quot;: {
        &quot;enabled&quot;: false,
        &quot;path&quot;: &quot;&quot;,
        &quot;hostname&quot;: &quot;&quot;
    },
    &quot;mysql&quot;: {
        &quot;enabled&quot;: false,
        &quot;server_addr&quot;: &quot;127.0.0.1&quot;,
        &quot;server_port&quot;: 3306,
        &quot;database&quot;: &quot;trojan&quot;,
        &quot;username&quot;: &quot;root&quot;,
        &quot;password&quot;: &quot;password&quot;,
        &quot;check_rate&quot;: 60
    }
}
</code></pre><h2 id="说明">说明</h2>
<h3 id="一般选项">一般选项</h3>
<ul>
<li>
<p>对于client或者nat，<code>remote_xxxx</code>应当填写你的trojan服务器地址和端口号，<code>local_xxxx</code>对应本地开放的socks5/http代理地址（自动适配）</p>
</li>
<li>
<p>对于server，<code>local_xxxx</code>对应trojan服务器监听地址（强烈建议使用443端口），<code>remote_xxxx</code>填写发现非trojan流量时代理到的Web服务地址，通常填写本地80端口。</p>
</li>
<li>
<p><code>log_level</code>是日志等级，等级越高，输出的信息越少，0输出所有信息，1输出Info以上信息，2输出Warning以上信息，3输出Error以上信息，4输出Fatal以上信息，5完全不输出日志。</p>
</li>
<li>
<p><code>password</code>可以填入多个密码。除了使用配置文件配置密码之外，trojan-go还支持使用mysql配置密码，参见下文。客户端的密码，与服务端配置文件中或者在数据库中的密码记录一致，才能使用trojan代理。</p>
</li>
</ul>
<h3 id="ssl选项"><code>ssl</code>选项</h3>
<p><code>verify</code>用于client/nat，表示客户端是否校验服务端提供的证书，默认开启。出于安全性考虑，这个选项不应该在实际场景中选择false，否则可能遭受中间人攻击。如果使用自签名或者自签发的证书，开启<code>verify</code>会导致校验失败。这种情况下，应当保持<code>verify</code>开启，然后在<code>cert</code>中填写服务端的证书，即可正常连接。</p>
<p>server必须填入<code>cert</code>和<code>key</code>，对应服务器的证书和私钥文件，请注意证书是否有效/过期。client可以不填写。如果使用自签名或者自签发的证书，应当在client的<code>cert</code>处填入服务器证书文件，否则可能导致校验失败。</p>
<p><code>sni</code>指的是证书的Common Name，如果你使用letsencrypt等机构签名的证书，这里填入你的域名。如果这一项未填，将使用<code>remote_addr</code>填充。你应当指定一个有效的SNI（和远端证书CN一致），否则客户端可能无法验证远端证书有效性从而无法连接。</p>
<p><code>cipher</code>和<code>cipher13</code>指client/server使用的密码学套件。只有在你明确知道自己在做什么的情况下，你才应该去填写cipher/cipher_tls13以修改trojan-go使用的TLS密码学套件。<strong>正常情况下，你应该将其留空或者不填</strong>，trojan-go会根据当前硬件平台以及远端的情况，自动选择最合适的加密算法以提升性能和安全性。如果需要填写，密码学套件名用分号(&quot;:&quot;)分隔。Golang的TLS库中中弃用了TLS1.2不安全的密码学套件，完全支持TLS1.3。如果你需要较高的安全性，而不担心跨硬件和软件平台的兼容性和性能，你可以强制要求trojan-go只使用TLS1.3密码学套件，设置cipher或者cipher13如下（填写cipher13和cipher是一样的）：</p>
<pre><code>    cipher13:&quot;TLS_AES_128_GCM_SHA256:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_256_GCM_SHA384&quot;
</code></pre><p>TLS Fallback(<code>fallback_port</code>)是Trojan-Go的特性，此特性可以更好地隐蔽Trojan服务器，抵抗GFW的主动检测，使得服务器的443端口在遭遇非TLS协议的探测时，行为与正常服务器完全一致。当服务器接受了一个连接但无法进行TLS握手时，如果<code>fallback_port</code>不为空，则流量将会被代理至remote_addr:fallback_port。例如，你可以在本地使用nginx开启一个https服务，当你的服务器443端口被非TLS协议请求时（比如http请求），trojan-go将代理至本地https服务器，nginx将使用http协议明文返回一个400 Bad Request页面。你可以通过使用浏览器访问http://your_domain_name.com:443进行验证。</p>
<h3 id="mux多路复用选项"><code>mux</code>多路复用选项</h3>
<p>多路复用是Trojan-Go的特性。如果服务器和客户端都是Trojan-Go，可以开启mux多路复用以减少高并发情景下的延迟（只需要客户端开启此选项即可，服务端自动适配）。</p>
<p><code>enabled</code>是否开启多路复用</p>
<p><code>mux_concurrency</code>指单个TLS隧道可以承载的最大连接数，默认为8。这个数值越大，多连接并发时TLS由于握手产生的延迟就越低，但网络吞吐量可能会有所降低，填入负数或者0表示所有连接只使用一个TLS隧道承载。</p>
<p><code>mux_idle_timeout</code>指TLS隧道在空闲多久之后关闭，单位为秒。</p>
<h3 id="router路由选项"><code>router</code>路由选项</h3>
<p>路由功能是Trojan-Go的特性。Trojan-Go的路由策略有三种。</p>
<ul>
<li>
<p>Proxy 代理。将请求通过TLS隧道进行代理，由trojan服务器和目的地址进行连接。</p>
</li>
<li>
<p>Bypass 绕过。直接在本地和目的地址进行连接。</p>
</li>
<li>
<p>Block 封锁。不代理请求，直接关闭连接。</p>
</li>
</ul>
<p>在<code>proxy</code>, <code>bypass</code>, <code>block</code>字段中填入对应列表文件名或者geoip/geosite标签名，Trojan-Go即根据列表中的IP（CIDR）或域名执行相应路由策略。列表文件中每行是一个IP或者域名，Trojan-Go会自动识别。</p>
<p><code>route_by_ip</code> 开启后，所有域名会被在本地解析为IP后，仅使用IP列表进行匹配。如果开启这个选项，可能导致DNS泄露。</p>
<p><code>route_by_ip_on_nonmatch</code>开启后，如果一个域名不在三个列表中，则会被在本地解析为IP后，仅使用IP列表进行匹配。如果开启这个选项，可能导致DNS泄露。</p>
<p><code>default_policy</code>指的是三个列表匹配均失败后，使用的默认策略，默认为Proxy，即进行代理。</p>
<h3 id="websocket选项"><code>websocket</code>选项</h3>
<p>Websocket传输是Trojan-Go的特性。在直接连接服务器的情况下，开启这个选项不会提升线路质量，也不会提升你的连接安全性。你只应该在下面两种情况下启用它：</p>
<ul>
<li>
<p>你需要利用CDN进行流量中转</p>
</li>
<li>
<p>你到代理节点的TLS连接遭到了GFW的中间人攻击</p>
</li>
</ul>
<p><code>enabled</code>表示是否启用websocket承载流量，服务端开启后同时支持一般Trojan协议和基于websocket的Trojan协议，客户端开启后将只使用websocket承载所有Trojan协议流量。</p>
<p><code>path</code>指的是websocket使用的URL路径，必须以斜杠(&quot;/&quot;)开头，并且服务器和客户端必须一致。<code>password</code>是可选选项，用于混淆内层TLS流量特征以降低遭到无良CDN流量识别的概率。如果设置了密码，服务端和客户端必须相同。</p>
<h3 id="数据库选项">数据库选项</h3>
<p>只有当<code>mysql</code>选项存在，并且<code>enabled</code>设置为true，trojan-go才会使用数据库。users表结构和trojan原版一致，下面是一个创建users表的命令。注意这里的password指的是密码经过SHA224哈希之后的值（字符串），流量download, upload, quota的单位是字节。你可以通过修改数据库users表中的用户记录的方式，添加和删除用户，或者指定用户的流量配额。Trojan-Go会根据所有的用户流量配额，自动更新当前有效的用户列表。如果download+upload&gt;quota，trojan-go服务器将拒绝该用户的连接。</p>
<pre><code>    CREATE TABLE users (
        id INT UNSIGNED NOT NULL AUTO_INCREMENT,
        username VARCHAR(64) NOT NULL,
        password CHAR(56) NOT NULL,
        quota BIGINT NOT NULL DEFAULT 0,
        download BIGINT UNSIGNED NOT NULL DEFAULT 0,
        upload BIGINT UNSIGNED NOT NULL DEFAULT 0,
        PRIMARY KEY (id),
        INDEX (password)
    );
</code></pre><p><code>check_rate</code>是Trojan-Go从MySQL更新用户数据缓存的间隔时间，单位是秒。</p>
<div class="edit-meta">

<br><a href="https://github.com/p4gefau1t/trojan-go/docs/edit/master/content/advance/config.md" class="edit-page"><i class="fas fa-pen-square"></i> Edit on GitHub</a></div><nav class="pagination"><a class="nav nav-prev" href="https://p4gefau1t.github.io/trojan-go/advance/forward/" title="流量中继"><i class="fas fa-arrow-left" aria-hidden="true"></i> Prev - 流量中继</a>
<a class="nav nav-next" href="https://p4gefau1t.github.io/trojan-go/advance/mux/" title="使用多路复用提升并发性能">Next - 使用多路复用提升并发性能 <i class="fas fa-arrow-right" aria-hidden="true"></i></a>
</nav><footer><p class="powered">Powered by <a href="https://gohugo.io">Hugo</a>. Theme by <a href="https://themes.gohugo.io/hugo-theme-techdoc/">TechDoc</a>. Designed by <a href="https://github.com/thingsym/hugo-theme-techdoc">Thingsym</a>.</p>
</footer>
</main><div class="sidebar">

<nav class="open-menu">
<ul>
<li class=""><a href="https://p4gefau1t.github.io/trojan-go">Home</a></li>

<li class=""><a href="https://p4gefau1t.github.io/trojan-go/basic/">基本配置</a>
  
<ul class="sub-menu">
<li class=""><a href="https://p4gefau1t.github.io/trojan-go/basic/trojan/">Trojan基本原理</a></li>
<li class=""><a href="https://p4gefau1t.github.io/trojan-go/basic/config/">正确配置Trojan-Go</a></li>
</ul>
  
</li>

<li class="parent"><a href="https://p4gefau1t.github.io/trojan-go/advance/">高级配置</a>
  
<ul class="sub-menu">
<li class=""><a href="https://p4gefau1t.github.io/trojan-go/advance/mux/">使用多路复用提升并发性能</a></li>
<li class=""><a href="https://p4gefau1t.github.io/trojan-go/advance/websocket/">使用Websocket进行CDN转发</a></li>
<li class=""><a href="https://p4gefau1t.github.io/trojan-go/advance/router/">使用路由功能实现国内直连和广告屏蔽</a></li>
<li class=""><a href="https://p4gefau1t.github.io/trojan-go/advance/forward/">流量中继</a></li>
<li class="active"><a href="https://p4gefau1t.github.io/trojan-go/advance/config/">完整的配置文件</a></li>
</ul>
  
</li>
</ul>
</nav>



<div class="sidebar-footer"></div>
</div>
</div><a href="#" id="backtothetop-fixed" class="backtothetop"
 data-backtothetop-duration="600"
 data-backtothetop-easing="easeOutQuart"
 data-backtothetop-fixed-fadeIn="1000"
 data-backtothetop-fixed-fadeOut="1000"
 data-backtothetop-fixed-bottom="10"
 data-backtothetop-fixed-right="20">
<span class="fa-layers fa-fw">
<i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up"></i>
</span></a>
</div>
</body>
</html>
